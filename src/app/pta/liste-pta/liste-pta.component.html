<div class="container-courrier">
  <div class="container-courrier">
    <div class="recherche-container">
      <h5>{{ title }}</h5>
      <!-- filtre par titre -->
      <div class="recherche-container-info">
        <div class="recherche" *ngIf="filterType === 'titre'">
          <div class="search-container">
            <input id="titre" (keyup)="applyFilter($event)" placeholder="Recherche par titre" class="search-input" />
            <span class="clear-icon" (click)="clearSearch()">
              <mat-icon>clear</mat-icon>
            </span>
          </div>
        </div>

        <!-- filtre par date -->
        <div class="recherche" *ngIf="filterType === 'datePta'">
          <div class="date-container">
            <input matInput [matDatepicker]="picker" (dateChange)="applyDateFilter($event)" class="date-input" placeholder="yy/mm/dd" [readonly]="true" />
            <mat-datepicker-toggle matSuffix [for]="picker" class="date-icon"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </div>
        </div>

        <mat-button-toggle-group #group="matButtonToggleGroup" (change)="toggleFilterType(group.value)">
          <mat-button-toggle (click)="clearFilter()" value="titre">Titre</mat-button-toggle>
          <mat-button-toggle (click)="clearFilter()" value="datePta">Date</mat-button-toggle>
        </mat-button-toggle-group>
        <button class="actualise" color="accent" (click)="clearFilter()">
          <mat-icon class="refresh">refresh</mat-icon>
        </button>
      </div>

      <!-- filtre par type -->
      <div class="filter-container">
        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Select type of PTA">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item *ngFor="let type of ptaTypes" (click)="onTypeChange(type)">
            <span>{{ type }}</span>
          </button>
        </mat-menu>
      </div>
    </div>

    <!-- Data Table -->
    <section class="section-container mat-elevation-z8" tabindex="0">
      <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8">
        
        <!-- Titre Column -->
        <ng-container matColumnDef="titre">
          <th mat-header-cell *matHeaderCellDef sticky> Titre </th>
          <td mat-cell *matCellDef="let pta"> {{pta.titre}} </td>
        </ng-container>

        <!-- type de pta -->
        <ng-container matColumnDef="typeDePta">
          <th mat-header-cell *matHeaderCellDef sticky> Pta </th>
          <td mat-cell *matCellDef="let pta">
            {{pta.typeDePta}}
          </td>
        </ng-container>

          <!-- DatePta Column -->
        <ng-container matColumnDef="datePta">
          <th mat-header-cell *matHeaderCellDef sticky> Date Insertion </th>
          <td mat-cell *matCellDef="let pta">
            {{ pta.datePta | date: 'shortDate' }}
          </td>
        </ng-container>

        <!-- Contenu Column -->
        <ng-container matColumnDef="contenue">
          <th mat-header-cell *matHeaderCellDef sticky> Contenu </th>
          <td mat-cell *matCellDef="let pta">
            <div class="consulter-courrier-container">
              <a class="consulter-courrier" *ngIf="pta.contenue" (click)="downloadFile(pta.contenue, pta.fileName, pta.typeDeContenue) ">
                {{ getFileExtension(pta.typeDeContenue) }} - Consulter 
              </a>
            </div>
          </td>
        </ng-container>
        
        <!-- Expand Button Column -->
        <ng-container matColumnDef="expand">
          <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
          <td mat-cell *matCellDef="let element">
            <button class="chevron" mat-icon-button aria-label="expand row" (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
              <mat-icon>{{expandedElement === element ? 'keyboard_arrow_up' : 'keyboard_arrow_down'}}</mat-icon>
            </button>
          </td>
        </ng-container>

        <!-- Expanded Content Column - Date Insertion -->
        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length + 1">
            <div class="section-table-element-detail"
                 [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
              <div class="section-table-element-diagram">
                Date d'insertion: {{element.datePta | date: 'fullDate'}}
              </div>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsWithExpand; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsWithExpand;"
            class="section-table-element-row"
            [class.section-table-expanded-row]="expandedElement === row"
            (click)="expandedElement = expandedElement === row ? null : row">
        </tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="section-table-detail-row"></tr>
      </table>
    </section>

    <!-- Paginator -->
    <mat-paginator [pageSizeOptions]="[10, 25, 50, 100, 200, 500]" showFirstLastButtons></mat-paginator>

    <!-- No Results Message -->
    <div *ngIf="noResults">
      Aucun résultat ne correspond à votre recherche
    </div>

    <a mat-fab class="retour" (click)="openArchivageDialog()">
      <mat-icon>archive</mat-icon>
    </a>
  </div>
</div>